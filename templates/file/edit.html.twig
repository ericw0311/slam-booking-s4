{% extends 'base.connected.html.twig' %}
 
{% block body %}

<legend><img src="{{ asset('images/file-32.png') }}"></img>&nbsp;{{ file.name }}&nbsp;
{% if file.user.id != userContext.user.id %}
	<button type="button" class="glyphicon glyphicon-pencil btn-link" style="color:red" data-toggle="modal" data-target="#unaCreator"></button>
{% else %}
	<a href="{{ path('file_modify', { 'fileID': file.ID }) }}" class="glyphicon glyphicon-pencil" title="{{ 'modify'|trans }}"></a>
{% endif %}
</legend>

<p><img src="{{ asset('images/administrator-32.png') }}"></img>&nbsp;{{ 'file.created.by'|trans }}&nbsp;{{ file.user.getFirstAndLastName() }}</p>

<div>
{% if file.ID == userContext.currentFileID and fileEditContext.bookingsCount > 0 %}
<a href="{{ path('file_booking_list', { 'fileID': file.ID, 'page': 1 }) }}"><img src="{{ asset('images/booking-32.png') }}"> {{ 'booking.plural'|trans }} <span class="badge">{{ fileEditContext.bookingsCount }}</span></a>
{% else %}
<img src="{{ asset('images/booking-32.png') }}"> {{ 'booking.plural'|trans }} <span class="badge">{{ fileEditContext.bookingsCount }}</span>
{% endif %}
</div>

<p>&nbsp;</p>
<legend><span class="glyphicon glyphicon-envelope"></span>&nbsp;{{ 'file.booking.email'|trans }}
{% if file.user.id == userContext.user.id %}
	<a href="{{ path('file_booking_email', { 'fileID': file.ID }) }}" class="glyphicon glyphicon-pencil" title="{{ 'modify'|trans }}"></a>
{% endif %}
</legend>

{% if fileEditContext.fileAdministrator %} {% set image = 'green-check-32.png' %} {% else %} {% set image = 'red-cross-32.png' %} {% endif %}
<p><img src="{{ asset('images/' ~ image) }}">&nbsp;{{ 'file.booking.email.administrator'|trans }}</p>

{% if fileEditContext.bookingUser %} {% set image = 'green-check-32.png' %} {% else %} {% set image = 'red-cross-32.png' %} {% endif %}
<p><img src="{{ asset('images/' ~ image) }}">&nbsp;{{ 'file.booking.email.user'|trans }}</p>

<div class="btn-group sb-margin-top">

<a href="{{ path('file', { 'page': 1 }) }}" class="btn btn-default"><i class="glyphicon glyphicon-chevron-left"></i> {{ 'file.back.to.list'|trans }}</a>

{% if file.user.id != userContext.user.id %}
	<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#dnaCreator"><span class="glyphicon glyphicon-trash"></span> <del>{{ 'delete'|trans }}</del></button>
{% elseif fileEditContext.bookingsCount > 0 %}
	<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#dnaBooking"><span class="glyphicon glyphicon-trash"></span> <del>{{ 'delete'|trans }}</del></button>
{% elseif (fileEditContext.userFilesCount + fileEditContext.userTimetablesCount + fileEditContext.resourcesCount + fileEditContext.labelsCount) > 0 %}
	<a href="{{ path('file_foreign', { 'fileID': file.ID }) }}" class="btn btn-danger"><i class="glyphicon glyphicon-trash"></i> <del>{{ 'delete'|trans }}</del></a>
{% else %}
	<a href="{{ path('file_delete', { 'fileID': file.ID }) }}" class="btn btn-danger"><i class="glyphicon glyphicon-trash"></i> {{ 'delete'|trans }}</a>
{% endif %}

{% if file.ID != userContext.currentFileID %}
	<a href="{{ path('file_set_current', { 'fileID': file.ID }) }}" class="btn btn-success"><i class="glyphicon glyphicon-paperclip"></i> {{ 'file.set.as.current'|trans }}</a>
{% endif %}

</div>

<!-- Modal -->
<div id="unaCreator" class="modal fade" role="dialog">
<div class="modal-dialog">
	<div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">&times;</button>
			<h4 class="modal-title">{{ 'update.not.allowed'|trans }}</h4>
		</div>
		<div class="modal-body">
			<p>{{ 'file.una.creator'|trans }}</p>
		</div>
		<div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">{{ 'close'|trans }}</button>
		</div>
	</div>
</div>
</div>

<div id="dnaCreator" class="modal fade" role="dialog">
<div class="modal-dialog">
	<div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">&times;</button>
			<h4 class="modal-title">{{ 'delete.not.allowed'|trans }}</h4>
		</div>
		<div class="modal-body">
			<p>{{ 'file.dna.creator'|trans }}</p>
		</div>
		<div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">{{ 'close'|trans }}</button>
		</div>
	</div>
</div>
</div>

<div id="dnaBooking" class="modal fade" role="dialog">
<div class="modal-dialog">
	<div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">&times;</button>
			<h4 class="modal-title">{{ 'delete.not.allowed'|trans }}</h4>
		</div>
		<div class="modal-body">
			<p>{{ 'file.dna.booking'|trans({'%name%': file.name}) }}</p>
		</div>
		<div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">{{ 'close'|trans }}</button>
		</div>
	</div>
</div>
</div>

{% endblock %}


{% block message %}

{% for flash_message in app.session.flashBag.get('notice') %}
<div class="alert alert-success sb-message">
	<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
	{{ flash_message|trans }}
</div>
{% endfor %}

{% endblock %}
